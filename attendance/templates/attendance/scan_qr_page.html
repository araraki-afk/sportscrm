{% extends 'attendance/base.html' %}

{% block title %}Сканировать QR{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">{{ section_time.section.name }}</h1>
    <h3 class="text-center">Время: {{ section_time.start_time }} - {{ section_time.end_time }}</h3>

    <div class="text-center my-5">
        <h4>Сканируйте QR-код</h4>
        <p>Нажмите кнопку ниже, чтобы открыть камеру для сканирования.</p>
        <button id="start-camera" class="btn btn-primary">Открыть камеру</button>

        <!-- Контейнер для сканера QR-кода -->
        <div id="reader" style="display: none; width: 100%; max-width: 500px; margin: 20px auto;"></div>
        <p id="scan-result" class="mt-3 text-success"></p>
    </div>
</div>

<!-- Подключаем библиотеку html5-qrcode -->
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>

<script>
    document.getElementById("start-camera").addEventListener("click", function () {
        // Показываем сканер
        document.getElementById("reader").style.display = "block";

        // Скрываем кнопку
        this.style.display = "none";

        // Инициализация сканера
        const html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250 }
        );

        // Обработка успешного сканирования
        html5QrcodeScanner.render(function onScanSuccess(decodedText) {
            document.getElementById('scan-result').innerHTML = `Код найден: ${decodedText}`;

            // Перенаправление на URL из QR-кода
            window.location.href = decodedText;
        });
    });
</script>
{% endblock %}
